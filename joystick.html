<!--
  Copyright 2021, Bart Butenaers
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at
  http://www.apache.org/licenses/LICENSE-2.0
  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/javascript">
    RED.nodes.registerType('ui_joystick',{
        category: 'dashboard',
        color: 'rgb( 63, 173, 181)',
        defaults: {
            group: {type: 'ui_group', required:true},
            order: {value: 0},
            width: {
                value: 0,
                validate: function(v) {
                    var valid = true
                    var width = v||0;
                    var currentGroup = $('#node-input-group').val()|| this.group;
                    var groupNode = RED.nodes.node(currentGroup);
                    valid = !groupNode || +width <= +groupNode.width;
                    $("#node-input-size").toggleClass("input-error",!valid);
                    return valid;
                }},
            height: {value: 0},
            name: {value: ''},
            useThemeColor: {value: true},
            color: {value: "white"},
            threshold: {value: 0.1, validate: function(v) { return v >= 0 && v <= 1}},
            directions: {value: "all"},
            shape: {value: "circle"},
            sendMovements: {value: true},
            send45Directions: {value: false},
            send90Directions: {value: false},
            timeInterval45: {value: 0},
            timeInterval90: {value: 0},
            centerAtRelease: {value: true}
        },
        inputs:1,
        outputs:1,
        icon: "font-awesome/fa-dot-circle-o",
        align: 'left',
        paletteLabel:"Joystick",
        label: function() {
            return this.name || "Joystick";
        },
        oneditprepare: function() {
            $("#node-input-size").elementSizer({
                width: "#node-input-width",
                height: "#node-input-height",
                group: "#node-input-group"
            });

            // Only show the custom color input field, when the 'theme' checkbox is unchecked
            $("#node-input-useThemeColor").change(function() {
                if(this.checked) {
                    $("#customColorDiv").hide();
                }
                else {
                    $("#customColorDiv").show();
                }
            });
            $("#node-input-useThemeColor").change();
            
            // Only show the timer(45) input field, when the 'output at 45° angle' checkbox is checked
            $("#node-input-send45Directions").change(function() {
                if(this.checked) {
                    $("#timeInterval45Div").show();
                }
                else {
                    $("#timeInterval45Div").hide();
                }
            });
            $("#node-input-send45Directions").change();            

            // Only show the timer(90) input field, when the 'output at 90° angle' checkbox is checked
            $("#node-input-send90Directions").change(function() {
                if(this.checked) {
                    $("#timeInterval90Div").show();
                }
                else {
                    $("#timeInterval90Div").hide();
                }
            });
            $("#node-input-send90Directions").change();    
        }
    });
</script>

<script type="text/x-red" data-template-name="ui_joystick">
    <div class="form-row" id="template-row-group">
        <label for="node-input-group"><i class="fa fa-table"></i> Group</span></label>
        <input type="text" id="node-input-group">
    </div>    
    <div class="form-row" id="template-row-size">
        <label><i class="fa fa-object-group"></i> Size</span></label>
        <input type="hidden" id="node-input-width">
        <input type="hidden" id="node-input-height">
        <button class="editor-button" id="node-input-size"></button>
    </div>
    <div class="form-row">
        <label for="node-input-directions"><i class="fa fa-arrows"></i> Directions</label>
        <select id="node-input-directions">
            <option value="all">All</option>
            <option value="ver">Only vertical</option>
            <option value="hor">Only horizontal</option>           
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-shape"><i class="fa fa-dot-circle-o"></i> Shape</label>
        <select id="node-input-shape">
            <option value="circle">Circle</option>
            <option value="squere">Square</option>        
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-threshold"><i class="fa fa-signal"></i> Threshold</label>
        <input type="number" id="node-input-threshold" min="0" max="1" step="0.1">
    </div>
    <div class="form-row">
        <input type="checkbox" id="node-input-useThemeColor" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-useThemeColor" style="width:70%;"> Use the Node-RED theme base color</label>
    </div>
    <div class="form-row" id = "customColorDiv">
        <label for="node-input-color"><i class="fa fa-paint-brush"></i> Color</label>
        <input type="color" id="node-input-color">
    </div>
    <div class="form-row">
        <input type="checkbox" id="node-input-sendMovements" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-sendMovements" style="width:70%;"> Send output msg at every change</label>
    </div>
    <div class="form-row">
        <input type="checkbox" id="node-input-send45Directions" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-send45Directions" style="width:70%;"> Send output msg at 45° direction change</label>
    </div>
    <div class="form-row" id="timeInterval45Div">
        <label for="node-input-timeInterval45"><i class="fa fa-clock-o"></i> Interval (45)</label>
        <input type="number" id="node-input-timeInterval45" min="0" step="0.1">
    </div>
    <div class="form-row">
        <input type="checkbox" id="node-input-send90Directions" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-send90Directions" style="width:70%;"> Send output msg at 90° direction change</label>
    </div>
    <div class="form-row" id="timeInterval90Div">
        <label for="node-input-timeInterval90"><i class="fa fa-clock-o"></i> Interval (90)</label>
        <input type="number" id="node-input-timeInterval90" min="0" step="0.1">
    </div>
    <div class="form-row">
        <input type="checkbox" id="node-input-centerAtRelease" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-centerAtRelease" style="width:70%;"> Move joystick to its center when released</label>
    </div>
</script>
<script type="text/x-red" data-help-name="ui_joystick">
    <p>A Node Red node to show a virtual joystick in the Node-RED dashboard.</p>
    <p><strong>Directions:</strong><br/>
    Specify in which directions the joystick can be moved:
    <ul>
        <li><i>All:</i> the joystick can be moved in all directions.</li>
        <li><i>Only vertical:</i> the joystick can only be moved vertically.</li>
        <li><i>Only horizontal:</i> the joystick can only be moved horizontally.</li>
    </ul></p>
    <p><strong>Shape:</strong><br/>
    Specify whether the shape of region - within which joystick can move - needs to be a circle or a square.</p>
    <p><strong>Threshold:</strong><br/>
    Specify the minimum distance needed to trigger an output message.  This is a value between 0 and 1:
    <ul>
        <li><code>0</code>: the center of the joystick, so the output message will always be sent.</li>
        <li><code>1</code>: the outer boundary of the joystick, which means that only an output message will be send when the joystick reaches the boundaries.</li>
    </ul></p>
    <p><strong>Use the Node-RED theme base color:</strong><br/>
    When activated, the base color of the Node-RED dashboard theme will be used.  Otherwise a custom color needs to be specified.</p>  
    <p><strong>Color:</strong><br/>
    Specify a custom CSS color of the joystick.</p> 
    <p><strong>Send output msg at every change:</strong><br/>
    When activated, output messages will be send for every moment.</p>     
    <p><strong>Send output msg at 45° direction change:</strong><br/>
    When activated, output messages will be send as soon as a direction (at 45° angle) has been determined (after reaching the threshold).</p>
    <p><strong>Interval (45):</strong><br/>
    Specify at which interval (seconds) the same (45°) direction should be repeated, as long as the threshold is exceeded.  When interval is 0, the messages won't be repeated.</p>     
    <p><strong>Send output msg at 90° direction change:</strong><br/>
    When activated, output messages will be send as soon as a direction (at 90° angle) has been determined (after reaching the threshold).</p>
    <p><strong>Interval (90):</strong><br/>
    Specify at which interval (seconds) the same (90°) direction should be repeated, as long as the threshold is exceeded.  When interval is 0, the messages won't be repeated.</p>  
    <p><strong>Move joystick to its center when released:</strong><br/>
    When activated, the joystick will automatically move back to its center when it is released.  Otherwise the joystick will remain at its release position.</p>     
</script>
