<!--
  Copyright 2021, Bart Butenaers
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at
  http://www.apache.org/licenses/LICENSE-2.0
  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/javascript">
    RED.nodes.registerType('ui_joystick',{
        category: 'dashboard',
        color: 'rgb( 63, 173, 181)',
        defaults: {
            group: {type: 'ui_group', required:true},
            order: {value: 0},
            width: {
                value: 0,
                validate: function(v) {
                    var valid = true
                    var width = v||0;
                    var currentGroup = $('#node-input-group').val()|| this.group;
                    var groupNode = RED.nodes.node(currentGroup);
                    valid = !groupNode || +width <= +groupNode.width;
                    $("#node-input-size").toggleClass("input-error",!valid);
                    return valid;
                }},
            height: {value: 0},
            name: {value: ''},
            color: {value: "white"},
            threshold: {value: 0.1, validate: function(v) { return v >= 0 && v <= 1}},
            directions: {value: "all"},
            shape: {value: "circle"},
            sendMovements: {value: true},
            send45Directions: {value: false},
            send90Directions: {value: false}
        },
        inputs:1,
        outputs:1,
        icon: "font-awesome/fa-dot-circle-o",
        align: 'left',
        paletteLabel:"Joystick",
        label: function() {
            return this.name || "Joystick";
        },
        oneditprepare: function() {
            $("#node-input-size").elementSizer({
                width: "#node-input-width",
                height: "#node-input-height",
                group: "#node-input-group"
            });
        }
    });
</script>

<script type="text/x-red" data-template-name="ui_joystick">
    <div class="form-row" id="template-row-group">
        <label for="node-input-group"><i class="fa fa-table"></i> Group</span></label>
        <input type="text" id="node-input-group">
    </div>    
    <div class="form-row" id="template-row-size">
        <label><i class="fa fa-object-group"></i> Size</span></label>
        <input type="hidden" id="node-input-width">
        <input type="hidden" id="node-input-height">
        <button class="editor-button" id="node-input-size"></button>
    </div>
    <div class="form-row">
        <label for="node-input-directions"><i class="fa fa-arrows"></i> Directions</label>
        <select id="node-input-directions">
            <option value="all">All</option>
            <option value="ver">Only vertical</option>
            <option value="hor">Only horizontal</option>           
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-shape"><i class="fa fa-dot-circle-o"></i> Shape</label>
        <select id="node-input-shape">
            <option value="circle">Circle</option>
            <option value="squere">Square</option>        
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-color"><i class="fa fa-paint-brush"></i> Color</label>
        <input type="color" id="node-input-color">
    </div>
    <div class="form-row">
        <label for="node-input-threshold"><i class="fa fa-signal"></i> Threshold</label>
        <input type="number" id="node-input-threshold" min="0" max="1" step="0.1">
    </div>
    <div class="form-row">
        <input type="checkbox" id="node-input-sendMovements" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-sendMovements" style="width:70%;"> Send output msg with movement info</label>
    </div>
    <div class="form-row">
        <input type="checkbox" id="node-input-send45Directions" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-send45Directions" style="width:70%;"> Send output msg with 45° directions°</label>
    </div>
    <div class="form-row">
        <input type="checkbox" id="node-input-send90Directions" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-send90Directions" style="width:70%;"> Send output msg with 90° directions</label>
    </div>
</script>
<script type="text/x-red" data-help-name="ui_joystick">
    <p>A Node Red node to show a virtual joystick in the Node-RED dashboard.</p>
    <p><strong>Directions:</strong><br/>
    Specify in which directions the joystick can be moved:
    <ul>
        <li><i>All:</i> the joystick can be moved in all directions.</li>
        <li><i>Only vertical:</i> the joystick can only be moved vertically.</li>
        <li><i>Only horizontal:</i> the joystick can only be moved horizontally.</li>
    </ul></p>
    <p><strong>Shape:</strong><br/>
    Specify whether the shape of region - within which joystick can move - needs to be a circle or a square.</p> 
    <p><strong>Color:</strong><br/>
    Specify the CSS color of the joystick.</p> 
    <p><strong>Threshold:</strong><br/>
    Specify the minimum distance needed to trigger an output message.  This is a value between 0 and 1:
    <ul>
        <li><code>0</code>: the center of the joystick, so the output message will always be sent.</li>
        <li><code>1</code>: the outer boundary of the joystick, which means that only an output message will be send when the joystick reaches the boundaries.</li>
    </ul></p>
    <p><strong>Send output msg with movement info:</strong><br/>
    When activated, output messages will be send containing information (position, ...) about the movement.</p>     
    <p><strong>Send output msg with 45° directions:</strong><br/>
    When activated, output messages will be send containing directions (up/down/left/right), which are split with a 45° angle.</p>     
    <p><strong>Send output msg with 90° directions:</strong><br/>
    When activated, output messages will be send containing pl (up/down/left/right), which are split with a 90° angle.</p>     
</script>
